<HTML>
<HEAD>
<TITLE>Hex Carry Chain Generator</TITLE>


<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />
<meta http-equiv="Content-type" content="text/html; charset=utf-8">

<link rel="stylesheet" type="text/css" href="css/jquery.mobile-1.4.5.min.css" />
<STYLE type="text/css">
<!--

body,input,button,.ui-btn,table {
	font-size: large;
	font-family: 'Courier New', monospace;
}

.divBody {
	font-size: medium;
}

.divNum {
	min-width:15em;
}

.divNum .ui-btn {
	font-size: large;
	margin: 0;
}

.tdTitle {
	font-size: small;
	text-align: right;
}

.tdColumn {
	font-size: x-large;
	text-align: right;
}

.tdUpper {
	font-size: large;
	text-align: center;
	vertical-align: top;
}

.tdColUnder {
	text-decoration: underline;
}

.tdColBold {
	font-weight:bold;;
}

//-->
</STYLE>


<SCRIPT type="text/javascript" charset="utf-8" src="js/jquery-1.11.2.min.js"></SCRIPT>
<script type="text/javascript" charset="utf-8" src="js/jquery.mobile-1.4.5.min.js"></script>
<SCRIPT language="javascript">
<!--

var mLier;
var mCand;
var numPro;
var numCar;

var max = 4;
var arrMul = new Array(max);
var arrPro = new Array(max);
var arrCar = new Array(max);

var isSleep;


jQuery(function ($) {
	generate();
	initialize();
	calculate();
	display();
	$("div.divNum input:button").click(function(){
		if ( !isSleep && verify($(this).val()) ) {
			isSleep = true;
			setTimeout( function() {
				if ( isSleep ) {
					shift();
					calculate();
					display();
					isSleep = false;
				}
			}, 1000);
		}
	});
	$("#gen").click(function(){
		initialize();
		calculate();
		display();
	});
	$("#help_mode").change(function(){
		if ( $("#help_mode").prop("checked") ) {
			$("#carry").show();
		} else {
			$("#carry").hide();
		}
	});
});


function generate() {
	var i;
	var inner = '<TABLE cellspacing="0" cellpadding="0">';

	inner += '<TR>';
	inner += '<TD class="tdTitle">multiplicand:&#160;</TD>';
	inner += '<TD class="tdColumn"></TD>';
	inner += '<TD class="tdColumn"><SPAN id="mpland"></SPAN></TD>';
	for ( i = 0; i < max; i++ ) {
		inner += '<TD class="tdColumn"><SPAN id="mpl' + i + '"></SPAN></TD>';
	}
	inner += '<TD class="tdColumn"></TD>';
	inner += '</TR>';

	inner += '<TR>';
	inner += '<TD class="tdTitle">multiplier:&#160;</TD>';
	inner += '<TD class="tdColumn tdColUnder">&times;&#160;</TD>';
	inner += '<TD class="tdColumn tdColUnder"><SPAN id="mplier"></SPAN></TD>';
	for ( i = 0; i < max; i++ ) {
		inner += '<TD class="tdColumn tdColUnder">&#160;&#160;</TD>';
	}
	inner += '<TD class="tdColumn tdColUnder">&#160;</TD>';
	inner += '</TR>';

	inner += '<TR>';
	inner += '<TD class="tdTitle">product:&#160;</TD>';
	inner += '<TD class="tdColumn"><SPAN id="res"></SPAN></TD>';
	inner += '<TD class="tdColumn tdColBold"><SPAN id="pro">?</SPAN></TD>';
	for ( i = 0; i < max; i++ ) {
		inner += '<TD class="tdColumn"><SPAN id="pro' + i + '"></SPAN></TD>';
	}
	inner += '<TD class="tdColumn"></TD>';
	inner += '</TR>';

	inner += '<TR id="carry">';
	inner += '<TD class="tdTitle">carry:&#160;</TD>';
	inner += '<TD class="tdColumn"></TD>';
	inner += '<TD class="tdColumn">&#160;</TD>';
	for ( i = 0; i < max; i++ ) {
		inner += '<TD class="tdUpper"><SPAN id="car' + i + '"></SPAN></TD>';
	}
	inner += '<TD class="tdColumn"></TD>';
	inner += '</TR>';

	inner += '</TABLE>';

	$("#colHTML").html(inner);
}

function initialize() {
	var i;

	isSleep = false;
	mLier = random_digit(2);
	numCar = 0;
	for ( i = 0; i < max; i++ ) {
		arrMul[i] = '&#160;';
		arrPro[i] = '&#160;';
		arrCar[i] = '&#160;';
	}
}

function random_digit(min) {
	var max = 15;

	if ( $("#hard_mode").prop("checked") ) {
		if ( Math.floor( Math.random() * 2 ) ) {
			max = 9;
		} else {
			min = 10;
		}
	}

	return Math.floor( Math.random() * (max-min+1) + min );
}

function random_unique(min) {
	var digit, hex;
	var i;

	do {
		digit = random_digit(min);
		hex = convert_hex(digit);

		for ( i = 0; i < max; i++ ) {
			if ( hex == arrMul[i] ) {
				digit = 0;
				break;
			}
		}
	} while ( digit == 0 );

	return digit;
}

function calculate() {
	var result;

	mCand = random_unique(1);
	result = mCand * mLier + numCar;

	numPro = result % 16;
	numCar = Math.floor( result / 16 );
}

function display() {
	var i;

	$("#mpland").html( convert_hex(mCand) );
	$("#mplier").html( convert_hex(mLier) );

	$("#res").html("&#160;");
	$("#pro").html("?");

	for ( i = 0; i < max; i++ ) {
		$("#mpl"+i).html(arrMul[i]);
		$("#pro"+i).html(arrPro[i]);
		$("#car"+i).html(arrCar[i]);
	}
}

function convert_hex(dec) {
	var hex = ['A', 'B', 'C', 'D', 'E', 'F'];

	if (dec >= 10) {
		return hex[dec-10];
	} else {
		return dec;
	}
}

function verify(val) {
	if (val == convert_hex(numPro)) {
		$("#res").html("&#10004;").css("color","green");
		$("#pro").html(val);
		return true;
	} else {
		$("#res").html("&#10005;").css("color","red");
		$("#pro").html(val);
		return false;
	}
}

function shift() {
	arrMul.unshift( convert_hex(mCand) );
	arrPro.unshift( convert_hex(numPro) );
	arrCar.unshift( convert_hex(numCar) );

	while ( arrMul.length > max ) {
		arrMul.pop();
	}

	while ( arrPro.length > max ) {
		arrPro.pop();
	}

	while ( arrCar.length > max ) {
		arrCar.pop();
	}
}

//-->
</SCRIPT>
</HEAD>


<BODY>
<div id="home" data-role="page">
	<div data-role="header" data-theme="b"> 
		<h1>Hex Chain</h1>
		<a href="#" id="gen" class="ui-btn ui-corner-all ui-btn-right" onclick="">New Game</a>
	</div> 
	<div role="main" class="ui-content">
		<FORM>
			<div id="colHTML"> 
			</div> 
			<HR>
			<div class="divBody">Select the product:</div>
			<div class="ui-grid-c divNum" style="min-width:15em">
				<div class="ui-block-a">
					<input type="button" value="0" class="ui-btn ui-corner-all">
				</div>
				<div class="ui-block-b">
					<input type="button" value="1" class="ui-btn ui-corner-all">
				</div>
				<div class="ui-block-c">
					<input type="button" value="2" class="ui-btn ui-corner-all">
				</div>
				<div class="ui-block-d">
					<input type="button" value="3" class="ui-btn ui-corner-all">
				</div>
				<div class="ui-block-a">
					<input type="button" value="4" class="ui-btn ui-corner-all">
				</div>
				<div class="ui-block-b">
					<input type="button" value="5" class="ui-btn ui-corner-all">
				</div>
				<div class="ui-block-c">
					<input type="button" value="6" class="ui-btn ui-corner-all">
				</div>
				<div class="ui-block-d">
					<input type="button" value="7" class="ui-btn ui-corner-all">
				</div>
				<div class="ui-block-a">
					<input type="button" value="8" class="ui-btn ui-corner-all">
				</div>
				<div class="ui-block-b">
					<input type="button" value="9" class="ui-btn ui-corner-all">
				</div>
				<div class="ui-block-c">
					<input type="button" value="A" class="ui-btn ui-corner-all">
				</div>
				<div class="ui-block-d">
					<input type="button" value="B" class="ui-btn ui-corner-all">
				</div>
				<div class="ui-block-a">
					<input type="button" value="C" class="ui-btn ui-corner-all">
				</div>
				<div class="ui-block-b">
					<input type="button" value="D" class="ui-btn ui-corner-all">
				</div>
				<div class="ui-block-c">
					<input type="button" value="E" class="ui-btn ui-corner-all">
				</div>
				<div class="ui-block-d">
					<input type="button" value="F" class="ui-btn ui-corner-all">
				</div>
			</div>
		</FORM>
	</div>
	<div data-role="footer" data-position="fixed" data-theme="b" class="ui-bar"> 
		<a href="#cfg" class="ui-btn ui-corner-all">Config</a>
	</div> 
</div>

<div id="cfg" data-role="page">
	<div data-role="header" data-theme="b">
		<a href="#" class="ui-btn ui-corner-all ui-btn-left" onclick="window.history.back();">Back</a>
		<h1>Config</h1> 
	</div> 
	<div role="main" class="ui-content">
		<FORM>
			<div class="ui-field-contain"> 
				<label for="hard_mode">Weight on A-F:</label>
				<INPUT type="checkbox" id="hard_mode" value="1" data-role="flipswitch" checked>
			</div>
			<div class="ui-field-contain"> 
				<label for="help_mode">Display carry row:</label>
				<INPUT type="checkbox" id="help_mode" value="1" data-role="flipswitch" checked>
			</div>
		</FORM>
	</div>
</div>

</BODY>
</HTML>
